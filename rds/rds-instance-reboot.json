{\r\n    \"kind\": \"Workflow\",\r\n    \"apiVersion\": \"argoproj.io\/v1alpha1\",\r\n    \"metadata\": {\r\n        \"name\": \"aws-rds-instance-reboot\",\r\n        \"namespace\": \"litmus\",\r\n        \"labels\": {\r\n            \"subject\": \"aws-rds-instance-reboot_litmus\"\r\n        }\r\n    },\r\n    \"spec\": {\r\n        \"templates\": [\r\n            {\r\n                \"name\": \"custom-chaos\",\r\n                \"steps\": [\r\n                    [\r\n                        {\r\n                            \"name\": \"install-chaos-faults\",\r\n                            \"template\": \"install-chaos-faults\"\r\n                        }\r\n                    ],\r\n                    [\r\n                        {\r\n                            \"name\": \"rds-instance-reboot-4yf\",\r\n                            \"template\": \"rds-instance-reboot-4yf\"\r\n                        }\r\n                    ],\r\n                    [\r\n                        {\r\n                            \"name\": \"cleanup-chaos-resources\",\r\n                            \"template\": \"cleanup-chaos-resources\"\r\n                        }\r\n                    ]\r\n                ]\r\n            },\r\n            {\r\n                \"name\": \"install-chaos-faults\",\r\n                \"inputs\": {\r\n                    \"artifacts\": [\r\n                        {\r\n                            \"name\": \"rds-instance-reboot-4yf\",\r\n                            \"path\": \"\/tmp\/rds-instance-reboot-4yf.yaml\",\r\n                            \"raw\": {\r\n                                \"data\": \"apiVersion: litmuschaos.io\/v1alpha1\\ndescription:\\n  message: |\\n    It injects rds-instance-reboot chaos on RDS cluster\\nkind: ChaosExperiment\\nmetadata:\\n  name: rds-instance-reboot\\n  labels:\\n    name: rds-instance-reboot\\n    app.kubernetes.io\/part-of: litmus\\n    app.kubernetes.io\/component: chaosexperiment\\n    app.kubernetes.io\/version: ci\\nspec:\\n  definition:\\n    scope: Namespaced\\n    permissions:\\n      - apiGroups:\\n          - \\\"\\\"\\n        resources:\\n          - pods\\n        verbs:\\n          - create\\n          - delete\\n          - get\\n          - list\\n          - patch\\n          - update\\n          - deletecollection\\n      - apiGroups:\\n          - \\\"\\\"\\n        resources:\\n          - events\\n        verbs:\\n          - create\\n          - get\\n          - list\\n          - patch\\n          - update\\n      - apiGroups:\\n          - \\\"\\\"\\n        resources:\\n          - configmaps\\n        verbs:\\n          - get\\n          - list\\n      - apiGroups:\\n          - \\\"\\\"\\n        resources:\\n          - pods\/log\\n        verbs:\\n          - get\\n          - list\\n          - watch\\n      - apiGroups:\\n          - \\\"\\\"\\n        resources:\\n          - pods\/exec\\n        verbs:\\n          - get\\n          - list\\n          - create\\n      - apiGroups:\\n          - apps\\n        resources:\\n          - deployments\\n          - statefulsets\\n          - replicasets\\n          - daemonsets\\n        verbs:\\n          - list\\n          - get\\n      - apiGroups:\\n          - apps.openshift.io\\n        resources:\\n          - deploymentconfigs\\n        verbs:\\n          - list\\n          - get\\n      - apiGroups:\\n          - \\\"\\\"\\n        resources:\\n          - replicationcontrollers\\n        verbs:\\n          - get\\n          - list\\n      - apiGroups:\\n          - argoproj.io\\n        resources:\\n          - rollouts\\n        verbs:\\n          - list\\n          - get\\n      - apiGroups:\\n          - batch\\n        resources:\\n          - jobs\\n        verbs:\\n          - create\\n          - list\\n          - get\\n          - delete\\n          - deletecollection\\n      - apiGroups:\\n          - litmuschaos.io\\n        resources:\\n          - chaosengines\\n          - chaosexperiments\\n          - chaosresults\\n        verbs:\\n          - create\\n          - list\\n          - get\\n          - patch\\n          - update\\n          - delete\\n    image: chaosnative\/chaos-go-runner:main-latest\\n    imagePullPolicy: Always\\n    args:\\n      - -c\\n      - .\/experiments -name rds-instance-reboot\\n    command:\\n      - \/bin\/bash\\n    env:\\n      - name: TOTAL_CHAOS_DURATION\\n        value: \\\"30\\\"\\n      - name: RAMP_TIME\\n        value: \\\"\\\"\\n      - name: CHAOS_INTERVAL\\n        value: \\\"10\\\"\\n      - name: CLUSTER_NAME\\n        value: ''\\n      - name: RDS_INSTANCE_IDENTIFIER\\n        value: ''\\n      - name: REGION\\n        value: ''\\n      - name: FAILOVER\\n        value: 'false'\\n      - name: INSTANCE_AFFECTED_PERC\\n        value: '100'\\n      - name: AWS_SHARED_CREDENTIALS_FILE\\n        value: \/tmp\/cloud_config.yml\\n      - name: DEFAULT_HEALTH_CHECK\\n        value: 'false'\\n      - name: SEQUENCE\\n        value: 'parallel'\\n    labels:\\n      name: rds-instance-reboot\\n      app.kubernetes.io\/part-of: litmus\\n      app.kubernetes.io\/component: experiment-job\\n      app.kubernetes.io\/version: ci\\n    secrets:\\n      - name: cloud-secret\\n        mountPath: \/tmp\/\\n\"\r\n                            }\r\n                        }\r\n                    ]\r\n                },\r\n                \"container\": {\r\n                    \"name\": \"\",\r\n                    \"image\": \"chaosnative\/k8s:1.15.0\",\r\n                    \"command\": [\r\n                        \"sh\",\r\n                        \"-c\"\r\n                    ],\r\n                    \"args\": [\r\n                        \"kubectl apply -f \/tmp\/ -n {{workflow.parameters.adminModeNamespace}} &&  sleep 30\"\r\n                    ]\r\n                }\r\n            },\r\n            {\r\n                \"name\": \"rds-instance-reboot-4yf\",\r\n                \"inputs\": {\r\n                    \"artifacts\": [\r\n                        {\r\n                            \"name\": \"rds-instance-reboot-4yf\",\r\n                            \"path\": \"\/tmp\/chaosengine-rds-instance-reboot-4yf.yaml\",\r\n                            \"raw\": {\r\n                                \"data\": \"apiVersion: litmuschaos.io\/v1alpha1\\nkind: ChaosEngine\\nmetadata:\\n  namespace: \\\"{{workflow.parameters.adminModeNamespace}}\\\"\\n  generateName: rds-instance-reboot-4yf\\n  labels:\\n    workflow_run_id: \\\"{{workflow.uid}}\\\"\\n    workflow_name: aws-rds-instance-reboot\\nspec:\\n  engineState: active\\n  chaosServiceAccount: litmus-admin\\n  experiments:\\n    - name: rds-instance-reboot\\n      spec:\\n        components:\\n          statusCheckTimeouts:\\n            delay: 2\\n            timeout: 400\\n          env:\\n            - name: TOTAL_CHAOS_DURATION\\n              value: \\\"30\\\"\\n            - name: CHAOS_INTERVAL\\n              value: \\\"10\\\"\\n            - name: CLUSTER_NAME\\n              value: \\\"\\\"\\n            - name: RDS_INSTANCE_IDENTIFIER\\n              value: \\\"\\\"\\n            - name: REGION\\n              value: \\\"\\\"\\n            - name: FAILOVER\\n              value: 'false'\\n            - name: INSTANCE_AFFECTED_PERC\\n              value: \\\"100\\\"\\n            - name: SEQUENCE\\n              value: parallel\\n        probe:\\n          - name: pre-healthcheck\\n            type: cmdProbe\\n            mode: SOT\\n            runProperties:\\n              probeTimeout: 5s\\n              retry: 0\\n              interval: 1s\\n              stopOnFailure: false\\n            cmdProbe\/inputs:\\n              command: .\/healthcheck -name aws-rds-pre-chaos\\n              source:\\n                image: chaosnative\/chaos-go-runner:main-latest\\n                inheritInputs: true\\n              comparator:\\n                type: string\\n                criteria: contains\\n                value: \\\"[P000]\\\"\\n          - name: post-healthcheck\\n            type: cmdProbe\\n            mode: EOT\\n            runProperties:\\n              probeTimeout: 5s\\n              retry: 0\\n              interval: 1s\\n              stopOnFailure: false\\n            cmdProbe\/inputs:\\n              command: .\/healthcheck -name aws-rds-post-chaos\\n              source:\\n                image: chaosnative\/chaos-go-runner:main-latest\\n                inheritInputs: true\\n              comparator:\\n                type: string\\n                criteria: contains\\n                value: \\\"[P000]\\\"\\n\"\r\n                            }\r\n                        }\r\n                    ]\r\n                },\r\n                \"metadata\": {\r\n                    \"labels\": {\r\n                        \"weight\": \"10\"\r\n                    }\r\n                },\r\n                \"container\": {\r\n                    \"name\": \"\",\r\n                    \"image\": \"chaosnative\/litmus-checker:1.15.0\",\r\n                    \"args\": [\r\n                        \"-file=\/tmp\/chaosengine-rds-instance-reboot-4yf.yaml\",\r\n                        \"-saveName=\/tmp\/engine-name\"\r\n                    ]\r\n                }\r\n            },\r\n            {\r\n                \"name\": \"cleanup-chaos-resources\",\r\n                \"container\": {\r\n                    \"name\": \"\",\r\n                    \"image\": \"chaosnative\/k8s:1.15.0\",\r\n                    \"command\": [\r\n                        \"sh\",\r\n                        \"-c\"\r\n                    ],\r\n                    \"args\": [\r\n                        \"kubectl delete chaosengine -l workflow_run_id={{workflow.uid}} -n {{workflow.parameters.adminModeNamespace}}\"\r\n                    ]\r\n                }\r\n            }\r\n        ],\r\n        \"entrypoint\": \"custom-chaos\",\r\n        \"arguments\": {\r\n            \"parameters\": [\r\n                {\r\n                    \"name\": \"adminModeNamespace\",\r\n                    \"value\": \"litmus\"\r\n                }\r\n            ]\r\n        },\r\n        \"serviceAccountName\": \"argo-chaos\",\r\n        \"securityContext\": {\r\n            \"runAsUser\": 1000,\r\n            \"runAsNonRoot\": true\r\n        }\r\n    }\r\n}
